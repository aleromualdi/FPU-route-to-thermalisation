# The Fermi-Pasta-Ulam-Tsingou system and its route to thermalization

This repository implements a deep learning methodology employing a Long Short-Term Memory (LSTM)-based autoencoder model to explore the lifespan of metastable states im the Fermi-Pasta-Ulam-Tsingou (FPUT) system and, consequently, identify the phase transition leading to equipartition.

## Installation

The code runs on Python 3.9

To install requirements:

```
pip install -r requirements.txt
```

## Generate input data
 
The input trajectory data for the FPUT are generated by an integrator based on Verlet algorithm. To generate the input dataset, consisting on a single trajectory for the non-linear parameter $\beta = 1.8$ run the script:

```
 python scripts/generate_input_data.py <args>
```

## The Fermi-Pasta-Ulam-Tsingou system and its route to thermalization

## Introduction
 
The Fermi-Pasta-Ulam-Tsingou (FPUT) system is a classic example in the field of nonlinear dynamics and statistical mechanics. It involves studying the dynamics of an array of coupled oscillators, initially thought to undergo thermalization, but instead exhibited persistent quasi-periodic behavior. Its classical formulation incorporates nonlinear couplings between oscillators, extending up to the fourth order. The resulting dynamics are governed by intricate nonlinear relationships among energy modes, where resonant modes play an iportant role in energy transfer and mode localization, giving rise to the well-known "FPUT recurrences."

As far back as 1982, researchers construed this phenomenon as indicative of the system manifesting two discernible "temporal regions". In the initial phase, the system undergoes relaxation, settling into an intermediate quasi-stationary state that endures for a duration before undergoing thermalisation. Within this phase, only some low frequency modes effectively take part to energy sharing, the energies of the remaining ones decaying exponentially. The energy profile keeps its form nearly unchanged for a rather large time scale.
In this subsequent phase, the system transitions into its genuine equilibrium state characterized by equipartition, with the high–frequency modes being progressively involved into the energy–sharing game. The intermediate, or "metastable" state, and the subsequent route to thermalization has been extensively studied by Giancarlo Benettin and colleagues [3-6].

Given the intricate nonlinear nature of the problem, a comprehensive mathematical treatment remains challenging. Nevertheless, a few theories, including the Kolmogorov-Arnold-Moser (KAM) theory, predict the persistence of invariant tori (quasi-periodic trajectories) in the phase space, particularly for small nonlinear coupling between the oscillators. This persistence manifests as the recurrence of initial conditions in the system's dynamic evolution, observable as distinct patterns in the energy distribution across modes. During this phase, the system resides in a "metastable state", a quasi-stationary condition that impedes the progression toward equipartition.

The spectral entropy $S$, i.e. the entropy associated with the energy, has been estensively used to quantify energy sharing among the degrees of freedom [1-2-3], and monitor the route towards thermalisation. Althouhg its computation is straightworard, it comes with some drawbacks. Firstly, its application requires detailed knowledge of the complete Hamiltonian of the system, encompassing both positions (q) and conjugate momenta (p). This reliance on full Hamiltonian information can be a substantial limitation, especially when obtaining such comprehensive data is impractical or challenging. Additionally, $S$ demonstrates non-smooth behavior, manifesting considerable variations and oscillations synchronized with the transfer of energy across different modes. These fluctuations, influenced by recurring dynamics in the FPUT system, pose challenges in interpreting the entropy's values over time. While attempts have been made to address this issue by introducing a time-averaged spectral entropy [1], this solution remains an approximate indicator of equipartition, requiring computation over extended durations to capture the recurrent dynamics adequately.

In this study, we present a deep learning methodology employing a Long Short-Term Memory (LSTM)-based autoencoder model to explore the lifespan of metastable states and, consequently, identify the phase transition leading to equipartition. An autoencoder is a neural network architecture designed for unsupervised learning tasks. It consists of an encoder that compresses input data into a latent space and a decoder that reconstructs the input from this condensed representation. The intrinsic ability to learn meaningful and compact representations from raw data renders autoencoders particularly valuable for tasks such as data compression, denoising, and anomaly detection. In essence, the autoencoder acts as a self-contained feature extractor, autonomously discerning and encapsulating complex patterns within the data. It is anticipated that the autoencoder will acquire a condensed manifold representation of the system dynamics, encompassing energy transfers across modes.

The use of autoencoder presents several advantages compared to the spectral energy approach. Autoencoders excel at capturing nonlinear patterns and transformations in data, making them particularly well-suited for the complexity inherent in the given problem. In contrast to spectral energy analysis, which focuses on frequency-based information and is more suitable for systems with linear or frequency-based features, autoencoders operate by autonomously learning data-driven representations from trajectory data of positions (q) alone. This eliminates the need for both position and momentum information, streamlining the input requirements. Furthermore, autoencoders demonstrate robustness to noise and data variability, as they learn a condensed representation that can filter out irrelevant noise, enhancing their performance in the presence of data fluctuations. In contrast, spectral energy analysis may exhibit sensitivity to noise, especially when it impacts frequency components.


## The Fermi-Pasta-Ulam-Tsingou model and energy transfer

The Hamiltonian representing the FPUT-$\beta$ chain of N coupled harmonic oscillator is [9]

$ H\left(q, p\right) = \frac{1}{2} \sum_{i=1}^{N} p_{i}^{2} + \frac{1}{2} \sum_{i=0}^{N} \left [ \left(q_{i+1} - q_i\right)^{2}  + \frac{\beta}{4}  \left(q_{i+1} - q_i\right)^{4} \right ]$,

where $p, q$ denote the canonical coordinates, i.e. $q=\left(q_0, q_1, \cdots, q_N\right), p=\left(p_0, p_1, \cdots, p_N\right)$. From the Hamiltonian, the equations of motion are numerically integrated using a symplectic integrator with a fixed integration step [], and assuming fixed boundaries $q_0 = q_{N+1} = 0$.

The harmonic part of the Hamiltonian can be put in the form of N independent normal modes $a_i$ via the canonical transformation ~\cite{giordano2006, FORD1992}

$a_j = \sqrt{\frac{2}{N+1} } \sum_{j=0}^{N} q_j \sin\left( \frac{jk\pi}{N+1}\right) $,

from which one can express the energy $E_k$ of normal $k$-th mode as ~\cite{fermi1955, giordano2006}

$ E_k = \frac{1}{2} \left[ \dot{a}_{k}^2  + \omega_{k}^{2}  a_{k}^2\right] $,

wher $\omega_{k} = 2 \sin\left(k\pi/2\left(N+1\right)\right)$ is the frequency of the  normal $k$-th mode.

Owing to the anharmonic characteristics of the potential, different modes become correlated leading to mode-coupling effects. Perturbations or alterations in one mode can influence the behavior of other modes, consequently facilitating energy sharing among them. In the initial "metastable" phase of FPUT-$\beta$ dynamics, only specific low-frequency modes actively participate in energy sharing, while the energies of the remaining modes decay exponentially with k/N. As time progresses, the interaction between diverse modes and the potential allows for the transfer of energy, ultimately leading to the thermalization process. This process culminates in a state of thermal equilibrium, where energy becomes uniformly distributed across the system.

The main statistical tool used to examine the evolution of the energy distribution is the spectral entropy

$ S(t) = - \sum_{k=1}^N e_k(t) \ln \left [ e_k(t) \right ]$

with $ e_k(t) = \frac{E_k(t)}{\sum_k E_k(t)}$ being the proportion of energy in mode $k$ at time $t$. The spectral entropy ranges from rom 0, when all the energy is in one mode, to $S_{max}$, when an equal amount of energy is present in all modes.

To remove the dependency on $N$, the rescaled form, defined as

$ \eta(t) = \frac{S(t) - S_{max}}{S(0) - S_{max}}$

is used. In terms of $\eta(t)$ the system is considered to be in equilibrium when $\eta = \langle\eta\rangle$ , where we calculate $\langle\eta\rangle$ following Danieli [1, 8]:

$ \langle\eta\rangle = \frac{1 - \gamma}{S_{max} - S(0)} $,

and $\gamma  \simeq 0.577 $ is the Euler–Mascheroni constant.



## Methods 

#### Dataset

The manifestation of the transition into energy equipartition becomes notably pronounced in a trajectory produced with a moderately intense non-linear coupling parameter. In this particular trajectory, energy equipartition becomes evident after a few superrecurrence cycles. To recreate this scenario, we simulated an FPUT trajectory comprising 1,200,000 points with a time step of 0.05 and a non-linear parameter $\beta$ set to 1.8. The trajectory exhibits multiple recurrences characteristic of the FPUT model and undergoes a phase transition into thermalization after approximately 5 recurrences. We designate the initial segment of the data, encompassing times up to the completion of the first recurrence, as the "train set", which is utilized for training our autoencoder model. Subsequently, we employ the entire trajectory data to evaluate the performance of the model.


#### Using Autoencoder model to detect phase transition 

The autoencoder is designed for sequence data with a specified number of time steps (timesteps) and features (n_features). The architecture consists of an LSTM layer with 32 units and ReLU activation, configured to return sequences. Subsequently, an LSTM layer with 8 units and ReLU activation is employed, and the encoder part is completed with a RepeatVector layer to replicate the encoded information. The decoder section involves another LSTM layer with 8 units, followed by an LSTM layer with 32 units, both configured to return sequences. The TimeDistributed layer with a Dense layer of n_features units is used for the reconstruction of the input sequence. The model is compiled using the Adam optimizer and Mean Squared Error (MSE) loss. 
We implemented the autoencoder model using the modules in Keras library.

Initially, we train the autoencoder model using a subset of trajectory data that encompasses instances of recurrences. Consequently, the trained autoencoder should proficiently reconstruct any input containing trajectory data snapshots that lie on the learned manifold with minimal reconstruction error (MAE). As the system progresses and shifts towards thermalisation, the destabilization of resonant energy states leads to the disruption of invariant tori in the phase space. Consequently, the autoencoder's reconstruction error gradually increases. The MAE can be therefore used to monitor the route to thermalisation in the FPUT model.

To employ Mean Absolute Error (MAE) as a metric for tracking the progression toward energy equipartition, we initially calculate the maximum MAE observed in the training set for each degree of freedom, referred to as a feature. These computed values then serve as thresholds. Subsequently, we gauge the MAE deviation at subsequent time points in comparison to these thresholds, averaging across degrees of freedom. The resultant signal, denoted as $MAE_{dev}$, encapsulates the extent to which each MAE value for various features deviates from its respective threshold.

The evolution of $MAE_{dev}$ is then juxtaposed with the mode energies and spectral entropy $S$ to discern patterns and correlations between the two metrics. This comparative analysis provides insights into the system's dynamical behavior and aids in detecting the transition into thermalisation associated with the breakdown of invariant tori in the phase space.

The $MAE_{dev}$ exhibits variability solely based on the autoencoder's proficiency in reconstructing input data through the acquired (nonlinear) mapping within the latent space. This characteristic implies that the signal's sensitivity is resilient to the individual exchange of energy modes, in contrast to the spectral entropy. Therefore, it can be inferred that a proficiently trained autoencoder model possesses the capability to discern deviations in trajectories departing from the invariant tori as the system undergoes thermalization, showcasing a high level of precision in its ability to capture and represent the evolving dynamics of the system.


## References

[1] The Metastable State of Fermi–Pasta–Ulam–Tsingou Models <br>
[2] Equipartition threshold in nonlinear large Hamiltonian systems: The Fermi-Pasta-Ulam model <br>
[3] Time–scales to equipartition in the Fermi–Pasta–Ulam problem: finite–size effects and thermodynamic limit G. Benettin and A. Ponno <br>
[4] G. Benettin A. Carati L. Galgani and A. Giorgilli, The Fermi–Pasta–Ulam Problem and the Metastability Perspective <br>
[5] Benettin, G.; Christodoulidi, H.; Ponno, A. The Fermi-Pasta-Ulam Problem and Its Underlying Integrable Dynamics. J. Stat. Phys.
2013, 152, 195–212.  <br>
[6] Benettin, G.; Pasquali, S.; Ponno, A. The Fermi–Pasta–Ulam Problem and Its Underlying Integrable Dynamics: An Approach
Through Lyapunov Exponents. J. Stat. Phys. 2018, 171, 521–542. <br>
[7] K. Ullmann, A. J. Lichtenberg, and G. Corso, Energy equipartition starting from high-frequency modes in the Fermi-Pasta-Ulam b oscillator chain
[8] Danieli, C.; Campbell, D.K.; Flach, S. Intermittent many-body dynamics at equilibrium. Phys. Rev. E 2017, 95, 60202. [CrossRef]
[9]  E. Fermi, J. Pasta, S. Ulam, and M. Tsingtou, in The Many- Body Problem, edited by D. C. Mattis ~World Scientific, Sin- gapore, 1993 reprinted!